(()=>{var e={18:e=>{"use strict";e.exports=require("tty")},23:e=>{"use strict";e.exports=require("util")},33:(e,t,n)=>{var r=n(18),i=n(23);(t=e.exports=n(910)).init=function(e){e.inspectOpts={};for(var n=Object.keys(t.inspectOpts),r=0;r<n.length;r++)e.inspectOpts[n[r]]=t.inspectOpts[n[r]]},t.log=function(){return s.write(i.format.apply(i,arguments)+"\n")},t.formatArgs=function(e){var n=this.namespace;if(this.useColors){var r=this.color,i="  [3"+r+";1m"+n+" [0m";e[0]=i+e[0].split("\n").join("\n"+i),e.push("[3"+r+"m+"+t.humanize(this.diff)+"[0m")}else e[0]=(new Date).toUTCString()+" "+n+" "+e[0]},t.save=function(e){null==e?delete process.env.DEBUG:process.env.DEBUG=e},t.load=o,t.useColors=function(){return"colors"in t.inspectOpts?Boolean(t.inspectOpts.colors):r.isatty(a)},t.colors=[6,2,3,4,5,1],t.inspectOpts=Object.keys(process.env).filter(function(e){return/^debug_/i.test(e)}).reduce(function(e,t){var n=t.substring(6).toLowerCase().replace(/_([a-z])/g,function(e,t){return t.toUpperCase()}),r=process.env[t];return r=!!/^(yes|on|true|enabled)$/i.test(r)||!/^(no|off|false|disabled)$/i.test(r)&&("null"===r?null:Number(r)),e[n]=r,e},{});var a=parseInt(process.env.DEBUG_FD,10)||2;1!==a&&2!==a&&i.deprecate(function(){},"except for stderr(2) and stdout(1), any other usage of DEBUG_FD is deprecated. Override debug.log if you want to use a different log function (https://git.io/debug_fd)")();var s=1===a?process.stdout:2===a?process.stderr:function(e){var t;switch(process.binding("tty_wrap").guessHandleType(e)){case"TTY":(t=new r.WriteStream(e))._type="tty",t._handle&&t._handle.unref&&t._handle.unref();break;case"FILE":(t=new(n(896).SyncWriteStream)(e,{autoClose:!1}))._type="fs";break;case"PIPE":case"TCP":(t=new(n(278).Socket)({fd:e,readable:!1,writable:!0})).readable=!1,t.read=null,t._type="pipe",t._handle&&t._handle.unref&&t._handle.unref();break;default:throw new Error("Implement me. Unknown stream file type!")}return t.fd=e,t._isStdio=!0,t}(a);function o(){return process.env.DEBUG}t.formatters.o=function(e){return this.inspectOpts.colors=this.useColors,i.inspect(e,this.inspectOpts).split("\n").map(function(e){return e.trim()}).join(" ")},t.formatters.O=function(e){return this.inspectOpts.colors=this.useColors,i.inspect(e,this.inspectOpts)},t.enable(o())},157:e=>{"use strict";e.exports=require("electron")},278:e=>{"use strict";e.exports=require("net")},313:(e,t,n)=>{var r=n(928),i=n(317).spawn,a=n(753)("electron-squirrel-startup"),s=n(157).app,o=function(e,t){var n=r.resolve(r.dirname(process.execPath),"..","Update.exe");a("Spawning `%s` with args `%s`",n,e),i(n,e,{detached:!0}).on("close",t)};e.exports=function(){if("win32"===process.platform){var e=process.argv[1];a("processing squirrel command `%s`",e);var t=r.basename(process.execPath);if("--squirrel-install"===e||"--squirrel-updated"===e)return o(["--createShortcut="+t],s.quit),!0;if("--squirrel-uninstall"===e)return o(["--removeShortcut="+t],s.quit),!0;if("--squirrel-obsolete"===e)return s.quit(),!0}return!1}()},317:e=>{"use strict";e.exports=require("child_process")},585:e=>{var t=1e3,n=60*t,r=60*n,i=24*r;function a(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}e.exports=function(e,s){s=s||{};var o,c=typeof e;if("string"===c&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var a=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(a){var s=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"days":case"day":case"d":return s*i;case"hours":case"hour":case"hrs":case"hr":case"h":return s*r;case"minutes":case"minute":case"mins":case"min":case"m":return s*n;case"seconds":case"second":case"secs":case"sec":case"s":return s*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}}}(e);if("number"===c&&!1===isNaN(e))return s.long?a(o=e,i,"day")||a(o,r,"hour")||a(o,n,"minute")||a(o,t,"second")||o+" ms":function(e){return e>=i?Math.round(e/i)+"d":e>=r?Math.round(e/r)+"h":e>=n?Math.round(e/n)+"m":e>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},753:(e,t,n)=>{"undefined"!=typeof process&&"renderer"===process.type?e.exports=n(833):e.exports=n(33)},833:(e,t,n)=>{function r(){var e;try{e=t.storage.debug}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e}(t=e.exports=n(910)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),n){var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var i=0,a=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(i++,"%c"===e&&(a=i))}),e.splice(a,0,r)}},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=r,t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(r())},896:e=>{"use strict";e.exports=require("fs")},910:(e,t,n)=>{var r;function i(e){function n(){if(n.enabled){var e=n,i=+new Date,a=i-(r||i);e.diff=a,e.prev=r,e.curr=i,r=i;for(var s=new Array(arguments.length),o=0;o<s.length;o++)s[o]=arguments[o];s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;c++;var i=t.formatters[r];if("function"==typeof i){var a=s[c];n=i.call(e,a),s.splice(c,1),c--}return n}),t.formatArgs.call(e,s),(n.log||t.log||console.log.bind(console)).apply(e,s)}}return n.namespace=e,n.enabled=t.enabled(e),n.useColors=t.useColors(),n.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),"function"==typeof t.init&&t.init(n),n}(t=e.exports=i.debug=i.default=i).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e),t.names=[],t.skips=[];for(var n=("string"==typeof e?e:"").split(/[\s,]+/),r=n.length,i=0;i<r;i++)n[i]&&("-"===(e=n[i].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(585),t.names=[],t.skips=[],t.formatters={}},928:e=>{"use strict";e.exports=require("path")}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}(()=>{"use strict";var e=n(157),t=n(928);const r=require("sqlite3"),i=require("fs/promises"),a=new class{constructor(){this.audioDir=t.join(e.app.getPath("userData"),"audio")}async initialize(){try{await i.access(this.audioDir)}catch(e){await i.mkdir(this.audioDir,{recursive:!0}),console.log("Created audio directory:",this.audioDir)}}generateAudioId(){return`${Date.now()}_${Math.random().toString(36).substr(2,9)}`}async copyAudioFile(e){await this.initialize();try{await i.access(e)}catch(t){throw new Error(`Audio file not found: ${e}`)}if(!await this.validateAudioFile(e))throw new Error(`Invalid audio file format: ${e}`);const n=this.generateAudioId(),r=`${n}${t.extname(e).toLowerCase()}`,a=t.join(this.audioDir,r);return await i.copyFile(e,a),console.log(`Copied audio file: ${e} -> ${a}`),{id:n,internalPath:r}}async deleteAudioFile(e){const n=t.join(this.audioDir,e);try{await i.unlink(n),console.log(`Deleted audio file: ${n}`)}catch(e){console.warn(`Could not delete audio file: ${n}`,e)}}async validateAudioFile(e){const n=t.extname(e).toLowerCase();if(![".mp3",".wav",".ogg",".m4a",".aac"].includes(n))return!1;try{const t=await i.stat(e);return t.isFile()&&t.size>0}catch(e){return!1}}getAudioMimeType(e){return{".mp3":"audio/mpeg",".wav":"audio/wav",".ogg":"audio/ogg",".m4a":"audio/mp4",".aac":"audio/aac"}[t.extname(e).toLowerCase()]||"audio/mpeg"}getAudioFilePath(e){return t.join(this.audioDir,e)}async audioFileExists(e){try{const t=this.getAudioFilePath(e);return await i.access(t),!0}catch(e){return!1}}getAudioDirectory(){return this.audioDir}};let s,o;n(313)&&e.app.quit();const c=()=>{s=new e.BrowserWindow({height:800,width:1200,minHeight:600,minWidth:800,titleBarStyle:"hiddenInset",webPreferences:{nodeIntegration:!1,contextIsolation:!0,preload:t.join(__dirname,"preload.js")}}),s.loadFile(t.join(__dirname,"../renderer/index.html"))};e.app.whenReady().then(()=>{c(),(()=>{const n=t.join(e.app.getPath("userData"),"dear-bones.db");o=new r.Database(n),o.serialize(()=>{o.run("\n      CREATE TABLE IF NOT EXISTS decks (\n        id TEXT PRIMARY KEY,\n        name TEXT NOT NULL,\n        description TEXT,\n        emoji TEXT,\n        tags TEXT,\n        created_at INTEGER NOT NULL,\n        updated_at INTEGER NOT NULL,\n        card_count INTEGER DEFAULT 0\n      )\n    "),o.run("\n      CREATE TABLE IF NOT EXISTS cards (\n        id TEXT PRIMARY KEY,\n        deck_id TEXT NOT NULL,\n        front TEXT,\n        back TEXT NOT NULL,\n        type TEXT DEFAULT 'text',\n        front_audio_path TEXT,\n        front_audio_name TEXT,\n        tags TEXT,\n        created_at INTEGER NOT NULL,\n        updated_at INTEGER NOT NULL,\n        last_studied INTEGER,\n        study_count INTEGER DEFAULT 0,\n        difficulty REAL DEFAULT 0,\n        interval INTEGER DEFAULT 1,\n        ease_factor REAL DEFAULT 2.5,\n        FOREIGN KEY (deck_id) REFERENCES decks (id) ON DELETE CASCADE\n      )\n    "),o.run("\n      CREATE TABLE IF NOT EXISTS study_sessions (\n        id TEXT PRIMARY KEY,\n        deck_id TEXT NOT NULL,\n        card_id TEXT NOT NULL,\n        confidence INTEGER NOT NULL,\n        response_time INTEGER NOT NULL,\n        studied_at INTEGER NOT NULL,\n        FOREIGN KEY (deck_id) REFERENCES decks (id) ON DELETE CASCADE,\n        FOREIGN KEY (card_id) REFERENCES cards (id) ON DELETE CASCADE\n      )\n    "),o.run("\n      CREATE TABLE IF NOT EXISTS settings (\n        key TEXT PRIMARY KEY,\n        value TEXT NOT NULL\n      )\n    ",e=>{var t;e?console.error("Error creating settings table:",e):(t=()=>{p()},console.log("Checking for database migrations..."),o.all("PRAGMA table_info(cards)",(e,n)=>{if(e)return console.error("Error checking table info:",e),void t();const r=n.some(e=>"type"===e.name),i=n.some(e=>"front_audio_path"===e.name),a=n.some(e=>"front_audio_name"===e.name);let s=0,c=0;const d=()=>{c++,c===s&&(console.log("Database migration completed"),t())};r||(s++,o.run("ALTER TABLE cards ADD COLUMN type TEXT DEFAULT 'text'",e=>{e?console.error("Error adding type column:",e):console.log("Added type column to cards table"),d()})),i||(s++,o.run("ALTER TABLE cards ADD COLUMN front_audio_path TEXT",e=>{e?console.error("Error adding front_audio_path column:",e):console.log("Added front_audio_path column to cards table"),d()})),a||(s++,o.run("ALTER TABLE cards ADD COLUMN front_audio_name TEXT",e=>{e?console.error("Error adding front_audio_name column:",e):console.log("Added front_audio_name column to cards table"),d()})),0===s&&(console.log("No database migrations needed"),t())}))})})})(),e.app.on("activate",()=>{0===e.BrowserWindow.getAllWindows().length&&c()})}),e.app.on("window-all-closed",()=>{"darwin"!==process.platform&&e.app.quit()}),e.ipcMain.handle("db-get-decks",()=>new Promise((e,t)=>{o.all("SELECT * FROM decks ORDER BY updated_at DESC",(n,r)=>{if(n)t(n);else{const t=r.map(e=>({...e,tags:JSON.parse(e.tags||"[]"),createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at),cardCount:e.card_count}));e(t)}})})),e.ipcMain.handle("db-create-deck",(e,t)=>new Promise((e,n)=>{const r=o.prepare("\n      INSERT INTO decks (id, name, description, emoji, tags, created_at, updated_at)\n      VALUES (?, ?, ?, ?, ?, ?, ?)\n    ");r.run([t.id,t.name,t.description,t.emoji,JSON.stringify(t.tags),Date.now(),Date.now()],function(r){r?n(r):e({id:t.id})}),r.finalize()})),e.ipcMain.handle("db-update-deck",(e,t,n)=>new Promise((e,r)=>{const i=[],a=[];void 0!==n.name&&(i.push("name = ?"),a.push(n.name)),void 0!==n.description&&(i.push("description = ?"),a.push(n.description)),void 0!==n.emoji&&(i.push("emoji = ?"),a.push(n.emoji)),void 0!==n.tags&&(i.push("tags = ?"),a.push(JSON.stringify(n.tags))),i.push("updated_at = ?"),a.push(Date.now()),a.push(t);const s=o.prepare(`\n      UPDATE decks SET ${i.join(", ")} WHERE id = ?\n    `);s.run(a,function(t){t?r(t):e({changes:this.changes})}),s.finalize()})),e.ipcMain.handle("db-delete-deck",(e,t)=>new Promise((e,n)=>{o.run("DELETE FROM cards WHERE deck_id = ?",[t],r=>{r?n(r):o.run("DELETE FROM decks WHERE id = ?",[t],function(t){t?n(t):e({changes:this.changes})})})})),e.ipcMain.handle("db-get-cards",(e,t)=>new Promise((e,n)=>{o.all("SELECT * FROM cards WHERE deck_id = ? ORDER BY updated_at DESC",[t],(t,r)=>{if(t)n(t);else{const t=r.map(e=>({...e,deckId:e.deck_id,type:e.type||"text",frontAudioPath:e.front_audio_path,frontAudioName:e.front_audio_name,tags:JSON.parse(e.tags||"[]"),createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at),lastStudied:e.last_studied?new Date(e.last_studied):void 0,studyCount:e.study_count,easeFactor:e.ease_factor}));e(t)}})})),e.ipcMain.handle("db-create-card",(e,t)=>new Promise((e,n)=>{const r=o.prepare("\n      INSERT INTO cards (id, deck_id, front, back, type, front_audio_path, front_audio_name, tags, created_at, updated_at, study_count, difficulty, interval, ease_factor)\n      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    ");r.run([t.id,t.deckId,t.front||null,t.back,t.type||"text",t.frontAudioPath||null,t.frontAudioName||null,JSON.stringify(t.tags),Date.now(),Date.now(),t.studyCount||0,t.difficulty||0,t.interval||1,t.easeFactor||2.5],function(r){r?n(r):o.run("UPDATE decks SET card_count = card_count + 1, updated_at = ? WHERE id = ?",[Date.now(),t.deckId],r=>{r?n(r):e({id:t.id})})}),r.finalize()})),e.ipcMain.handle("db-update-card",(e,t,n)=>new Promise((e,r)=>{const i=[],a=[];void 0!==n.front&&(i.push("front = ?"),a.push(n.front)),void 0!==n.back&&(i.push("back = ?"),a.push(n.back)),void 0!==n.type&&(i.push("type = ?"),a.push(n.type)),void 0!==n.frontAudioPath&&(i.push("front_audio_path = ?"),a.push(n.frontAudioPath)),void 0!==n.frontAudioName&&(i.push("front_audio_name = ?"),a.push(n.frontAudioName)),void 0!==n.tags&&(i.push("tags = ?"),a.push(JSON.stringify(n.tags))),void 0!==n.lastStudied&&(i.push("last_studied = ?"),a.push(n.lastStudied instanceof Date?n.lastStudied.getTime():n.lastStudied)),void 0!==n.studyCount&&(i.push("study_count = ?"),a.push(n.studyCount)),void 0!==n.difficulty&&(i.push("difficulty = ?"),a.push(n.difficulty)),void 0!==n.interval&&(i.push("interval = ?"),a.push(n.interval)),void 0!==n.easeFactor&&(i.push("ease_factor = ?"),a.push(n.easeFactor)),i.push("updated_at = ?"),a.push(Date.now()),a.push(t);const s=o.prepare(`\n      UPDATE cards SET ${i.join(", ")} WHERE id = ?\n    `);s.run(a,function(t){t?r(t):e({changes:this.changes})}),s.finalize()})),e.ipcMain.handle("db-delete-card",(e,t)=>new Promise((e,n)=>{o.get("SELECT deck_id FROM cards WHERE id = ?",[t],(r,i)=>{if(r)return void n(r);if(!i)return void e({changes:0});const a=i.deck_id;o.run("DELETE FROM cards WHERE id = ?",[t],function(t){t?n(t):o.run("UPDATE decks SET card_count = card_count - 1, updated_at = ? WHERE id = ?",[Date.now(),a],t=>{t?n(t):e({changes:this.changes})})})})})),e.ipcMain.handle("db-get-study-sessions",(e,t)=>new Promise((e,n)=>{const r=t?"SELECT * FROM study_sessions WHERE deck_id = ? ORDER BY studied_at DESC":"SELECT * FROM study_sessions ORDER BY studied_at DESC",i=t?[t]:[];o.all(r,i,(t,r)=>{if(t)n(t);else{const t=r.map(e=>({...e,deckId:e.deck_id,cardId:e.card_id,responseTime:e.response_time,studiedAt:new Date(e.studied_at)}));e(t)}})})),e.ipcMain.handle("db-create-study-session",(e,t)=>new Promise((e,n)=>{const r=o.prepare("\n      INSERT INTO study_sessions (id, deck_id, card_id, confidence, response_time, studied_at)\n      VALUES (?, ?, ?, ?, ?, ?)\n    ");r.run([t.id,t.deckId,t.cardId,t.confidence,t.responseTime,Date.now()],function(r){r?n(r):e({id:t.id})}),r.finalize()})),e.ipcMain.handle("db-get-settings",()=>new Promise((e,t)=>{o.all("SELECT * FROM settings",(n,r)=>{if(n)t(n);else{const t={};r.forEach(e=>{try{t[e.key]=JSON.parse(e.value)}catch{t[e.key]=e.value}}),e(t)}})})),e.ipcMain.handle("db-update-setting",(e,t,n)=>new Promise((e,r)=>{const i=o.prepare("\n      INSERT OR REPLACE INTO settings (key, value) VALUES (?, ?)\n    ");i.run([t,JSON.stringify(n)],function(i){i?r(i):e({key:t,value:n})}),i.finalize()})),e.ipcMain.handle("audio-import-file",async(e,t)=>{try{const e=await a.copyAudioFile(t);return{success:!0,audioId:e.id,internalPath:e.internalPath}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to import audio file"}}}),e.ipcMain.handle("audio-delete-file",async(e,t)=>{try{return await a.deleteAudioFile(t),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to delete audio file"}}}),e.ipcMain.handle("audio-validate-file",async(e,t)=>{try{return{success:!0,isValid:await a.validateAudioFile(t)}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to validate audio file"}}}),e.ipcMain.handle("audio-get-file-path",async(e,t)=>{try{return{success:!0,fullPath:a.getAudioFilePath(t),exists:await a.audioFileExists(t)}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to get audio file path"}}});const d=async(e,t,n)=>new Promise((r,i)=>{o.get("SELECT id FROM decks WHERE name = ?",[e],(a,s)=>{if(a)return void i(a);if(s)return void r(s.id);const c=Date.now().toString()+"_"+Math.random().toString(36).substr(2,9),d=o.prepare("\n        INSERT INTO decks (id, name, description, emoji, tags, created_at, updated_at, card_count)\n        VALUES (?, ?, ?, ?, ?, ?, ?, ?)\n      ");d.run([c,e,"Imported from CSV",t,JSON.stringify([]),Date.now(),Date.now(),0],function(t){t?i(t):(n.decksCreated.push(e),r(c))}),d.finalize()})}),u=async(e,t,n,r,i,a,s,c="text",d,u)=>new Promise((l,p)=>{const f=Date.now().toString()+"_"+Math.random().toString(36).substr(2,9),h=o.prepare("\n      INSERT INTO cards (id, deck_id, front, back, type, front_audio_path, front_audio_name, tags, created_at, updated_at, study_count, difficulty, interval, ease_factor)\n      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    ");h.run([f,e,t||null,n,c,d||null,u||null,JSON.stringify(r),Date.now(),Date.now(),s,i,a,2.5],function(t){t?p(t):o.run("UPDATE decks SET card_count = card_count + 1, updated_at = ? WHERE id = ?",[Date.now(),e],e=>{e?p(e):l()})}),h.finalize()});e.ipcMain.handle("export-csv",async(t,n)=>{try{const t=n?await l(n):"all-decks",r=await e.dialog.showSaveDialog(s,{defaultPath:`${t}.csv`,filters:[{name:"CSV Files",extensions:["csv"]},{name:"All Files",extensions:["*"]}]});if(!r.canceled&&r.filePath)try{const e=await(async e=>new Promise((t,n)=>{const r=e?"SELECT c.*, d.name as deck_name, d.emoji as deck_emoji \n         FROM cards c JOIN decks d ON c.deck_id = d.id \n         WHERE c.deck_id = ? \n         ORDER BY c.created_at":"SELECT c.*, d.name as deck_name, d.emoji as deck_emoji \n         FROM cards c JOIN decks d ON c.deck_id = d.id \n         ORDER BY d.name, c.created_at",i=e?[e]:[];o.all(r,i,(r,i)=>{if(r)return void n(r);const a=[];e?a.push("Type,Front,Front Audio File,Front Audio Name,Back,Tags,Difficulty,Interval,Study Count"):a.push("Deck Name,Deck Emoji,Type,Front,Front Audio File,Front Audio Name,Back,Tags,Difficulty,Interval,Study Count"),i.forEach(t=>{const n=JSON.parse(t.tags||"[]").join(";"),r=t.type||"text",i=t.front||"",s=t.front_audio_path||"",o=t.front_audio_name||"",c=(e?[r,i,s,o,t.back,n,t.difficulty.toString(),t.interval.toString(),t.study_count.toString()]:[t.deck_name,t.deck_emoji||"",r,i,s,o,t.back,n,t.difficulty.toString(),t.interval.toString(),t.study_count.toString()]).map(e=>{const t=String(e);return t.includes(",")||t.includes('"')||t.includes("\n")?`"${t.replace(/"/g,'""')}"`:t});a.push(c.join(","))}),t(a.join("\n"))})}))(n);return await i.writeFile(r.filePath,e,"utf-8"),{success:!0,filePath:r.filePath}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to export CSV"}}return{success:!1,error:"Export cancelled"}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Export failed"}}}),e.ipcMain.handle("import-csv",async(n,r)=>{try{const n=await e.dialog.showOpenDialog(s,{filters:[{name:"CSV Files",extensions:["csv"]},{name:"All Files",extensions:["*"]}],properties:["openFile"]});if(!n.canceled&&n.filePaths.length>0){const e=await(async(e,n)=>{try{const r=await i.readFile(e,"utf-8"),s=e=>{const t=[];let n=[],r="",i=!1,a=0;for(;a<e.length;){const s=e[a],o=e[a+1];'"'===s?i&&'"'===o?(r+='"',a+=2):(i=!i,a++):","!==s||i?"\n"!==s||i?("\r"===s||(r+=s),a++):(n.push(r.trim()),n.some(e=>e.length>0)&&t.push(n),n=[],r="",a++):(n.push(r.trim()),r="",a++)}return(r.trim()||n.length>0)&&(n.push(r.trim()),n.some(e=>e.length>0)&&t.push(n)),t},o=s(r);if(o.length<2)throw new Error("CSV file must have at least a header and one data row");const c=o[0].map(e=>e.toLowerCase().trim()),l={success:!0,imported:0,errors:[],decksCreated:[]},p=c.findIndex(e=>e.includes("back"));if(-1===p)throw new Error("CSV must contain Back column");const f=c.findIndex(e=>e.includes("type")),h=c.findIndex(e=>e.includes("front")&&!e.includes("audio")),m=c.findIndex(e=>e.includes("front")&&e.includes("audio")&&e.includes("file")),E=c.findIndex(e=>e.includes("front")&&e.includes("audio")&&e.includes("name")),g=c.findIndex(e=>e.includes("tag")),y=c.findIndex(e=>e.includes("deck")&&e.includes("name")),_=c.findIndex(e=>e.includes("deck")&&e.includes("emoji")),w=c.findIndex(e=>e.includes("difficulty")),T=c.findIndex(e=>e.includes("interval")),v=c.findIndex(e=>e.includes("study")&&e.includes("count"));for(let r=1;r<o.length;r++)try{const i=o[r];if(i.length<p+1){l.errors.push(`Row ${r+1}: Insufficient columns`);continue}const s=i[p]?.trim();if(!s){l.errors.push(`Row ${r+1}: Back is required`);continue}const c=f>=0&&i[f]?.trim()||"text",k=h>=0&&i[h]?.trim()||"",A=m>=0&&i[m]?.trim()||"",S=E>=0&&i[E]?.trim()||"";if("text"===c&&!k){l.errors.push(`Row ${r+1}: Text cards require Front text`);continue}if(("audio"===c||"mixed"===c)&&!A){l.errors.push(`Row ${r+1}: Audio/Mixed cards require Front Audio File`);continue}if("mixed"===c&&!k){l.errors.push(`Row ${r+1}: Mixed cards require both Front text and audio`);continue}let N=n;if(!N&&y>=0){const e=i[y]?.trim();if(!e){l.errors.push(`Row ${r+1}: No deck specified`);continue}N=await d(e,i[_]?.trim()||"ðŸ“š",l)}else if(!N){l.errors.push(`Row ${r+1}: No target deck specified`);continue}const R=g>=0&&i[g]?.split(";").filter(e=>e.trim())||[],b=w>=0&&parseFloat(i[w])||0,D=T>=0&&parseInt(i[T])||1,O=v>=0&&parseInt(i[v])||0;let I="",L=S;if(("audio"===c||"mixed"===c)&&A)try{const n=t.dirname(e);let r=A;t.isAbsolute(r)||(r=t.resolve(n,r)),I=(await a.copyAudioFile(r)).internalPath,L||(L=t.basename(r)),console.log(`Imported audio file: ${r} -> ${I}`)}catch(e){l.errors.push(`Row ${r+1}: Audio file error - ${e instanceof Error?e.message:"Unknown error"}`);continue}await u(N,k,s,R,b,D,O,c,I,L),l.imported++}catch(e){l.errors.push(`Row ${r+1}: ${e instanceof Error?e.message:"Unknown error"}`)}return l}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to import CSV"}}})(n.filePaths[0],r);return e}return{success:!1,error:"Import cancelled"}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Import failed"}}});const l=async e=>new Promise((t,n)=>{o.get("SELECT name FROM decks WHERE id = ?",[e],(e,r)=>{if(e)n(e);else if(r){const e=r.name.replace(/[^a-zA-Z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"");t(e||"deck")}else t("deck")})}),p=()=>{o.get("SELECT COUNT(*) as count FROM decks",(e,t)=>{if(e)console.error("Error checking deck count:",e);else if(0===t.count){console.log("Seeding database with sample data...");const e=[{id:"1",name:"Spanish Vocabulary",description:"Essential Spanish words and phrases",emoji:"ðŸ‡ªðŸ‡¸",tags:["language","spanish"]},{id:"2",name:"Biology Terms",description:"Key concepts in biology",emoji:"ðŸ§¬",tags:["science","biology"]}],t=[{id:"1",deckId:"1",front:"Hello",back:"Hola",tags:["greetings"]},{id:"2",deckId:"1",front:"Thank you",back:"Gracias",tags:["greetings"]},{id:"3",deckId:"1",front:"Goodbye",back:"AdiÃ³s",tags:["greetings"]},{id:"4",deckId:"2",front:"Cell",back:"The basic unit of life",tags:["basic"]},{id:"5",deckId:"2",front:"DNA",back:"Deoxyribonucleic acid - carries genetic information",tags:["genetics"]}],n=o.prepare("\n        INSERT INTO decks (id, name, description, emoji, tags, created_at, updated_at, card_count)\n        VALUES (?, ?, ?, ?, ?, ?, ?, ?)\n      ");e.forEach(e=>{const r=t.filter(t=>t.deckId===e.id).length;n.run([e.id,e.name,e.description,e.emoji,JSON.stringify(e.tags),Date.now(),Date.now(),r])}),n.finalize();const r=o.prepare("\n        INSERT INTO cards (id, deck_id, front, back, tags, created_at, updated_at, study_count, difficulty, interval, ease_factor)\n        VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n      ");t.forEach(e=>{r.run([e.id,e.deckId,e.front,e.back,JSON.stringify(e.tags),Date.now(),Date.now(),0,0,1,2.5])}),r.finalize(),console.log("Sample data seeded successfully")}})};e.app.on("before-quit",()=>{o&&o.close()})})()})();
//# sourceMappingURL=index.js.map